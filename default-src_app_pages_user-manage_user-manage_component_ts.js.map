{"version":3,"sources":["./src/app/pages/user-manage/user-manage.component.ts","./src/app/pages/user-manage/user-manage.component.html"],"names":[],"mappings":"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","file":"default-src_app_pages_user-manage_user-manage_component_ts.js","sourcesContent":["import { UploadDrawerComponent } from './../../shared/components/upload-drawer/upload-drawer.component';\r\nimport { Router } from '@angular/router';\r\nimport { UserModifyDrawerComponent } from '@shared/components/user-modify-drawer/user-modify-drawer.component';\r\nimport { UserManageService } from './user-manage.service';\r\nimport { Component, OnInit, ViewChild, ElementRef, Input } from '@angular/core';\r\nimport { User, Role, FilterType } from '@app/shared/types/commonTypes';\r\nimport { CommonService } from '@app/core/services/common.service';\r\nimport { CacheService } from '@app/core/services/cache.service';\r\n\r\n@Component({\r\n  selector: 'user-manage',\r\n  templateUrl: './user-manage.component.html',\r\n  styleUrls: ['./user-manage.component.scss'],\r\n  providers: [UserManageService],\r\n})\r\nexport class UserManageComponent implements OnInit {\r\n  @Input() checkMode = false;\r\n  @Input() defaultChecked?: string[];\r\n  @ViewChild('userModifyDrawer') userDrawerEl!: UserModifyDrawerComponent;\r\n  @ViewChild('uploadDrawerEl') uploadDrawerEl!: UploadDrawerComponent;\r\n  pageIndex = 1;\r\n  pageSize = 20;\r\n  total = 0;\r\n  checked = false; // 全选状态\r\n  loading = false;\r\n  indeterminate = false; // 半选状态\r\n  listOfData: User[] = [];\r\n  setOfCheckedId = new Set<string>(); // 已选中集合\r\n  param: any;\r\n  type!: number;\r\n  isAdd: boolean = true;\r\n  oldValue: any;\r\n  // 权限Modal\r\n  roleModal = {\r\n    roles: <Role[]>[],\r\n    value: null,\r\n    visible: false,\r\n    loading: false,\r\n    open: () => {\r\n      this.roleModal.visible = true;\r\n    },\r\n    cancel: () => {\r\n      this.roleModal.visible = false;\r\n    },\r\n    setRole: () => {\r\n      const param = {\r\n        roles: this.roleModal.value as unknown as string[],\r\n        user_ids: Array.from(this.setOfCheckedId),\r\n      };\r\n      this.service.setUserRole(param).subscribe((res) => {\r\n        this.roleModal.cancel();\r\n        this.getUser();\r\n      });\r\n    },\r\n  };\r\n\r\n  constructor(\r\n    private service: UserManageService,\r\n    private commonService: CommonService,\r\n    public cache: CacheService,\r\n    private router: Router,\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.getRoles();\r\n    this.type = this.router.url === '/teacher-manage' ? 1 : 0;\r\n    setTimeout(() => {\r\n      if (this.defaultChecked?.length) {\r\n        for (const item of this.defaultChecked) {\r\n          if (!this.setOfCheckedId.has(item)) {\r\n            this.setOfCheckedId.add(item);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // 添加用户\r\n  addUser() {\r\n    this.isAdd = true;\r\n    this.userDrawerEl.addOpen();\r\n  }\r\n  // 修改用户\r\n  modifyUser(data: any) {\r\n    this.oldValue = {\r\n      gender: data.gender,\r\n      account: data.account,\r\n      name: data.name,\r\n      grade: data.grade,\r\n      college: data.college_id,\r\n      major: data?.major_id,\r\n      class: data?.class_id,\r\n      role: data.role.map((item: FilterType) => item.id),\r\n    };\r\n    this.isAdd = false;\r\n    this.userDrawerEl.formGroup.reset();\r\n    this.userDrawerEl.open();\r\n  }\r\n\r\n  // 查询用户\r\n  queryUser(isFirst = false) {\r\n    if (this.param) {\r\n      this.service\r\n        .queryUser({ ...this.param, pageIndex: this.pageIndex, pageSize: this.pageSize, type: this.type })\r\n        .subscribe((res: any) => {\r\n          this.listOfData = res.data as any[];\r\n          if (isFirst) {\r\n            this.total = res.total;\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  // 搜索用户\r\n  searchUser(isFirst = false) {\r\n    this.service\r\n      .searchUser({ ...this.param, pageIndex: this.pageIndex, pageSize: this.pageSize, type: this.type })\r\n      .subscribe((res: any) => {\r\n        this.listOfData = res.data as any[];\r\n        if (isFirst) {\r\n          this.total = res.total;\r\n        }\r\n      });\r\n  }\r\n\r\n  // 换页/页尺寸\r\n  getUser() {\r\n    if (this.param?.keyword) {\r\n      this.searchUser();\r\n    } else {\r\n      this.queryUser();\r\n    }\r\n  }\r\n\r\n  // 获取所有角色\r\n  getRoles() {\r\n    this.commonService.getRoles().subscribe((res) => {\r\n      this.roleModal.roles = res as Role[];\r\n    });\r\n  }\r\n\r\n  // 接收参数\r\n  getConditions(param: any) {\r\n    if (!this.checkMode) {\r\n      this.setOfCheckedId.clear();\r\n    }\r\n    this.pageIndex = 1;\r\n    if (['grade', 'college', 'major', 'class'].includes(param.code)) {\r\n      this.param =\r\n        this.type === 1\r\n          ? { college: param.data.college.id }\r\n          : {\r\n              major: param.data.major.id,\r\n              grade: param.data.grade.id,\r\n              college: param.data.college.id,\r\n              class: param.data.class.id,\r\n            };\r\n      this.queryUser(true);\r\n    } else if (param.code === 'chargeClass') {\r\n      this.param = {\r\n        class: param.data.chargeClass.id,\r\n      };\r\n      this.queryUser(true);\r\n    } else if (param.code === 'userSearch') {\r\n      this.param = {\r\n        keyword: param.data.userSearch.trim(),\r\n      };\r\n      this.searchUser(true);\r\n    }\r\n  }\r\n\r\n  // 添加/删除选中\r\n  updateCheckedSet(id: string, checked: boolean): void {\r\n    if (checked) {\r\n      this.setOfCheckedId.add(id);\r\n    } else {\r\n      this.setOfCheckedId.delete(id);\r\n    }\r\n  }\r\n\r\n  // 刷新全/半选状态\r\n  refreshCheckedStatus(): void {\r\n    this.checked = this.listOfData.every(({ account }) => this.setOfCheckedId.has(account));\r\n    this.indeterminate = this.listOfData.some(({ account }) => this.setOfCheckedId.has(account)) && !this.checked;\r\n  }\r\n\r\n  // 选中时更新集合刷新全半选状态\r\n  onItemChecked(id: string, checked: boolean): void {\r\n    this.updateCheckedSet(id, checked);\r\n    this.refreshCheckedStatus();\r\n  }\r\n\r\n  // 全选单页\r\n  onAllChecked(checked: boolean): void {\r\n    this.listOfData.forEach(({ account }) => this.updateCheckedSet(account, checked));\r\n    this.refreshCheckedStatus();\r\n  }\r\n\r\n  // 强制下线\r\n  logout() {\r\n    let param = Array.from(this.setOfCheckedId);\r\n    this.service.makeOffLine(param).subscribe((res) => {\r\n      this.getUser();\r\n    });\r\n  }\r\n  // 重置密码\r\n  resetPWD() {\r\n    let param = Array.from(this.setOfCheckedId);\r\n    this.service.resetDefaultPassword(param).subscribe();\r\n  }\r\n  // 删除用户\r\n  deleteUser() {\r\n    let param = Array.from(this.setOfCheckedId);\r\n    this.service.deleteUsers(param).subscribe((res) => {\r\n      this.setOfCheckedId.clear();\r\n      this.checked = false;\r\n      this.getUser();\r\n    });\r\n  }\r\n\r\n  // 导出用户\r\n  output() {\r\n    this.commonService.download('/user/exportUser', { ...this.param, type: this.type });\r\n  }\r\n}\r\n","<div class=\"view_scroll padding\">\r\n  <cascade-condition\r\n    (cascadeEmitter)=\"getConditions($event)\"\r\n    [showFilter]=\"\r\n      type === 1\r\n        ? ['grade', 'college', 'userSearch']\r\n        : ['grade', 'college', 'major', 'class', 'chargeClass', 'userSearch']\r\n    \"\r\n  ></cascade-condition>\r\n  <div class=\"flex-between mt10\" *ngIf=\"!checkMode\">\r\n    <div>\r\n      <button\r\n        nz-button\r\n        nzType=\"primary\"\r\n        class=\"mr5\"\r\n        (click)=\"addUser()\"\r\n        *ngIf=\"type ? cache.functionPermissions('addTeacher') : cache.functionPermissions('addStudent')\"\r\n      >\r\n        添加用户\r\n      </button>\r\n      <button\r\n        nz-button\r\n        nzType=\"primary\"\r\n        class=\"mr5\"\r\n        (click)=\"uploadDrawerEl.open()\"\r\n        *ngIf=\"type ? cache.functionPermissions('importTeacher') : cache.functionPermissions('importStudent')\"\r\n      >\r\n        导入用户\r\n      </button>\r\n      <button\r\n        nz-button\r\n        nzType=\"primary\"\r\n        [disabled]=\"!listOfData?.length\"\r\n        *ngIf=\"type ? cache.functionPermissions('exportTeacher') : cache.functionPermissions('exportStudent')\"\r\n        (click)=\"output()\"\r\n      >\r\n        导出用户\r\n      </button>\r\n    </div>\r\n    <div>\r\n      <i\r\n        nz-icon\r\n        nzType=\"info-circle\"\r\n        nzTheme=\"twotone\"\r\n        nz-tooltip\r\n        nzTooltipPlacement=\"bottom\"\r\n        nzTooltipTitle=\"多选用户以执行批量操作\"\r\n        class=\"mr5\"\r\n      ></i>\r\n      <span class=\"reminder mr5\" *ngIf=\"setOfCheckedId.size\">已选中{{ setOfCheckedId.size }}人</span>\r\n      <button\r\n        [disabled]=\"!setOfCheckedId.size\"\r\n        nz-button\r\n        nzType=\"primary\"\r\n        class=\"mr5\"\r\n        (click)=\"roleModal.open()\"\r\n        *ngIf=\"\r\n          type ? cache.functionPermissions('setTeacherPermission') : cache.functionPermissions('setStudentPermission')\r\n        \"\r\n      >\r\n        设置用户角色\r\n      </button>\r\n      <button\r\n        [disabled]=\"!setOfCheckedId.size\"\r\n        nz-button\r\n        nzType=\"primary\"\r\n        class=\"mr5\"\r\n        nz-popconfirm\r\n        nzPopconfirmTitle=\"确认强制下线?\"\r\n        nzOkText=\"确认\"\r\n        nzCancelText=\"取消\"\r\n        (nzOnConfirm)=\"logout()\"\r\n        *ngIf=\"type ? cache.functionPermissions('setTeacherOffset') : cache.functionPermissions('setStudentOffset')\"\r\n      >\r\n        强制下线\r\n      </button>\r\n      <button\r\n        [disabled]=\"!setOfCheckedId.size\"\r\n        nz-button\r\n        nzType=\"primary\"\r\n        class=\"mr5\"\r\n        nz-popconfirm\r\n        nzPopconfirmTitle=\"确认重置密码?\"\r\n        nzOkText=\"确认\"\r\n        nzCancelText=\"取消\"\r\n        (nzOnConfirm)=\"resetPWD()\"\r\n        *ngIf=\"\r\n          type ? cache.functionPermissions('resetTeacherPassword') : cache.functionPermissions('resetStudentPassword')\r\n        \"\r\n      >\r\n        重置密码\r\n      </button>\r\n      <button\r\n        [disabled]=\"!setOfCheckedId.size\"\r\n        nz-button\r\n        nzType=\"primary\"\r\n        nz-popconfirm\r\n        nzPopconfirmTitle=\"确认删除用户?\"\r\n        nzOkText=\"确认\"\r\n        nzCancelText=\"取消\"\r\n        (nzOnConfirm)=\"deleteUser()\"\r\n        *ngIf=\"type ? cache.functionPermissions('deleteTeacher') : cache.functionPermissions('deleteStudent')\"\r\n      >\r\n        删除用户\r\n      </button>\r\n    </div>\r\n  </div>\r\n  <div class=\"mt10\">\r\n    <nz-table\r\n      #userTable\r\n      nzSize=\"small\"\r\n      nzBordered\r\n      nzShowPagination\r\n      nzShowSizeChanger\r\n      [nzFrontPagination]=\"false\"\r\n      [nzTotal]=\"total\"\r\n      [nzData]=\"listOfData\"\r\n      [(nzPageIndex)]=\"pageIndex\"\r\n      [(nzPageSize)]=\"pageSize\"\r\n      (nzPageIndexChange)=\"getUser()\"\r\n      (nzPageSizeChange)=\"getUser()\"\r\n    >\r\n      <thead>\r\n        <tr>\r\n          <th [nzChecked]=\"checked\" [nzIndeterminate]=\"indeterminate\" (nzCheckedChange)=\"onAllChecked($event)\"></th>\r\n          <th>帐号</th>\r\n          <th>姓名</th>\r\n          <th>性别</th>\r\n          <th>学院</th>\r\n          <th *ngIf=\"type === 0\">专业</th>\r\n          <th *ngIf=\"type === 0\">班级</th>\r\n          <th *ngIf=\"type === 0\">班主任</th>\r\n          <th *ngIf=\"!checkMode\">角色</th>\r\n          <th *ngIf=\"!checkMode\">状态</th>\r\n          <th\r\n            nzAlign=\"center\"\r\n            *ngIf=\"\r\n              !checkMode && (type ? cache.functionPermissions('editTeacher') : cache.functionPermissions('editStudent'))\r\n            \"\r\n          >\r\n            操作\r\n          </th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr *ngFor=\"let data of userTable.data\">\r\n          <td\r\n            [nzChecked]=\"setOfCheckedId.has(data.account)\"\r\n            (nzCheckedChange)=\"onItemChecked(data.account, $event)\"\r\n          ></td>\r\n          <td>{{ data.account }}</td>\r\n          <td>{{ data.name }}</td>\r\n          <td>{{ data.gender }}</td>\r\n          <td>{{ data.college }}</td>\r\n          <td *ngIf=\"type === 0\">{{ data.major }}</td>\r\n          <td *ngIf=\"type === 0\">{{ data.class }}</td>\r\n          <td *ngIf=\"type === 0\">{{ data.chargeTeacher }}</td>\r\n          <td *ngIf=\"!checkMode\">{{ data.role | textFrom }}</td>\r\n          <td *ngIf=\"!checkMode\">{{ data.status ? '在线' : '离线' }}</td>\r\n          <td *ngIf=\"!checkMode\" nzAlign=\"center\">\r\n            <button\r\n              nz-button\r\n              nzType=\"link\"\r\n              (click)=\"modifyUser(data)\"\r\n              *ngIf=\"type ? cache.functionPermissions('editTeacher') : cache.functionPermissions('editStudent')\"\r\n            >\r\n              修改用户\r\n            </button>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </nz-table>\r\n  </div>\r\n</div>\r\n\r\n<!-- 用户信息抽屉 -->\r\n<user-modify-drawer\r\n  #userModifyDrawer\r\n  [default]=\"param\"\r\n  [value]=\"oldValue\"\r\n  [type]=\"type\"\r\n  [isAdd]=\"isAdd\"\r\n  (handleOk)=\"queryUser()\"\r\n></user-modify-drawer>\r\n\r\n<!-- 设置用户角色 -->\r\n<nz-modal\r\n  nzWidth=\"300px\"\r\n  [(nzVisible)]=\"roleModal.visible\"\r\n  [nzMaskClosable]=\"false\"\r\n  [nzKeyboard]=\"false\"\r\n  [nzTitle]=\"(setOfCheckedId.size > 1 ? '批量' : '') + '设置用户角色'\"\r\n  (nzOnOk)=\"roleModal.setRole()\"\r\n  (nzOnCancel)=\"roleModal.cancel()\"\r\n  [nzOkLoading]=\"roleModal.loading\"\r\n>\r\n  <ng-container *nzModalContent>\r\n    <span nz-typography nzType=\"danger\">注意：此操作将会覆盖用户原有权限！</span>\r\n    <nz-select nzMode=\"multiple\" [(ngModel)]=\"roleModal.value\" style=\"width: 100%\">\r\n      <nz-option *ngFor=\"let item of roleModal.roles\" [nzValue]=\"item.key\" [nzLabel]=\"item.title\"></nz-option>\r\n    </nz-select>\r\n  </ng-container>\r\n</nz-modal>\r\n\r\n<upload-drawer\r\n  #uploadDrawerEl\r\n  url=\"/user/importUser\"\r\n  errorUrl=\"/user/downloadErrorUser\"\r\n  templateUrl=\"/user/downloadTemplate\"\r\n></upload-drawer>\r\n"],"sourceRoot":"webpack:///"}