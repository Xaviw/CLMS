{"version":3,"sources":["./src/app/pages/permission-setup/permission-setup.component.ts","./src/app/pages/permission-setup/permission-setup.component.html","./src/app/pages/permission-setup/permission-setup.module.ts"],"names":[],"mappings":"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","file":"src_app_pages_permission-setup_permission-setup_module_ts.js","sourcesContent":["import { CommonService } from './../../core/services/common.service';\r\nimport { NzFormatEmitEvent, NzTreeNode, NzTreeNodeOptions } from 'ng-zorro-antd/tree';\r\nimport { PermissionSetupService } from './permission-setup.service';\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { Role, PageRoute } from '@app/shared/types/commonTypes';\r\n\r\n@Component({\r\n  selector: 'app-permission-setup',\r\n  templateUrl: './permission-setup.component.html',\r\n  styleUrls: ['./permission-setup.component.scss'],\r\n  providers: [PermissionSetupService],\r\n})\r\nexport class PermissionSetupComponent implements OnInit {\r\n  roles: Role[] = []; // 角色数据\r\n  activeRole: NzTreeNode | undefined; // 当前选中角色\r\n  pages: PageRoute[] = []; // 页面数据\r\n  pageFunctions = new Map(); // 页面功能数据\r\n  expandSet = new Set<string>(); // 已展开页面列表\r\n  // 角色操作对话框\r\n  roleModel = {\r\n    visible: false, // 显示控制\r\n    loading: false, // 确认loading状态控制\r\n    value: '', // 文本框值\r\n    mode: true, // 当前模式，true=>添加，false=>修改\r\n    add: () => {\r\n      this.roleModel.visible = true;\r\n      this.roleModel.mode = true;\r\n    },\r\n    update: () => {\r\n      this.roleModel.visible = true;\r\n      this.roleModel.mode = false;\r\n      this.roleModel.value = this.activeRole?.origin.title!;\r\n    },\r\n    // 添加角色\r\n    addRole: () => {\r\n      this.roleModel.loading = true;\r\n      this.service.addRole(this.roleModel.value).subscribe(\r\n        (res) => {\r\n          this.roleModel.loading = false;\r\n          this.roleModel.visible = false;\r\n          this.getRoles();\r\n          this.roleModel.value = '';\r\n        },\r\n        (err) => {\r\n          this.roleModel.loading = false;\r\n        },\r\n      );\r\n    },\r\n    // 修改角色\r\n    modifyRole: () => {\r\n      this.roleModel.loading = true;\r\n      const param = {\r\n        role_id: this.activeRole!.key,\r\n        role_name: this.roleModel.value,\r\n      };\r\n      this.service.modifyRole(param).subscribe(\r\n        (res) => {\r\n          this.roleModel.loading = false;\r\n          this.roleModel.visible = false;\r\n          this.getRoles();\r\n          this.roleModel.value = '';\r\n        },\r\n        (err) => {\r\n          this.roleModel.loading = false;\r\n        },\r\n      );\r\n    },\r\n    cancel: () => {\r\n      this.roleModel.visible = false;\r\n      this.roleModel.value = '';\r\n    },\r\n  };\r\n\r\n  // 展开页面触发\r\n  onExpandChange(id: string, checked: boolean, isLeaf: boolean): void {\r\n    if (checked) {\r\n      this.expandSet.add(id);\r\n      if (!this.pageFunctions.get(id)) {\r\n        this.getPageFunctions(id);\r\n      }\r\n    } else {\r\n      this.expandSet.delete(id);\r\n    }\r\n  }\r\n\r\n  constructor(private service: PermissionSetupService, private common: CommonService) {}\r\n\r\n  ngOnInit() {\r\n    this.getRoles();\r\n    this.getAllPages();\r\n  }\r\n\r\n  // 获取所有角色\r\n  getRoles() {\r\n    this.common.getRoles().subscribe((res) => {\r\n      (res as Role[]).forEach((item: Role) => {\r\n        item.isLeaf = true;\r\n        item.icon = 'user';\r\n        item.pages = [];\r\n        item.actions = [];\r\n      });\r\n      this.roles = res as Role[];\r\n    });\r\n  }\r\n\r\n  // 获取完整菜单\r\n  getAllPages() {\r\n    this.common.getAllPages().subscribe((res) => {\r\n      this.pages = res as PageRoute[];\r\n    });\r\n  }\r\n\r\n  // 获取页面功能\r\n  getPageFunctions(param: string) {\r\n    this.common.getPageFunctions(param).subscribe((res) => {\r\n      this.pageFunctions.set(param, res);\r\n    });\r\n  }\r\n\r\n  // 获取角色菜单权限\r\n  getRolePages(origin: NzTreeNodeOptions) {\r\n    this.service.getRolePages(origin.key).subscribe((res) => {\r\n      origin.pages = res;\r\n    });\r\n  }\r\n\r\n  // 获取角色功能权限\r\n  getRolePageActions(origin: NzTreeNodeOptions) {\r\n    this.service.getRolePageFunctions(origin.key).subscribe((res) => {\r\n      origin.actions = res;\r\n    });\r\n  }\r\n\r\n  // 单击角色\r\n  roleClick(e: NzFormatEmitEvent) {\r\n    if (this.activeRole !== e.node) {\r\n      this.activeRole = e.node!;\r\n      if (!e.node?.origin.pages.length || !e.node?.origin.actions.length) {\r\n        this.getRolePages(this.activeRole?.origin!);\r\n        this.getRolePageActions(this.activeRole?.origin!);\r\n      }\r\n    } else {\r\n      this.activeRole = undefined;\r\n    }\r\n  }\r\n\r\n  // 修改功能权限\r\n  modifyFunctionPermission(e: NzFormatEmitEvent, id: string) {\r\n    if (e) {\r\n      this.service.addFunctionPermission({ role_id: this.activeRole?.key!, permissions_id: id }).subscribe(\r\n        (res) => {},\r\n        (err) => {\r\n          // 修改出错，重新请求已有权限\r\n          this.getRolePages(this.activeRole?.origin!);\r\n          this.getRolePageActions(this.activeRole?.origin!);\r\n        },\r\n      );\r\n    } else {\r\n      this.service.cancelFunctionPermission({ role_id: this.activeRole?.key!, permissions_id: id }).subscribe(\r\n        (res) => {},\r\n        (err) => {\r\n          // 修改出错，重新请求已有权限\r\n          this.getRolePages(this.activeRole?.origin!);\r\n          this.getRolePageActions(this.activeRole?.origin!);\r\n        },\r\n      );\r\n    }\r\n  }\r\n\r\n  // 修改页面权限\r\n  modifyPagePermission(e: NzFormatEmitEvent, id: string) {\r\n    if (e) {\r\n      this.service.addPagePermission({ role_id: this.activeRole?.key!, page_id: id }).subscribe(\r\n        (res) => {},\r\n        (err) => {\r\n          // 修改出错，重新请求已有权限\r\n          this.getRolePages(this.activeRole?.origin!);\r\n          this.getRolePageActions(this.activeRole?.origin!);\r\n        },\r\n      );\r\n    } else {\r\n      this.service.cancelPagePermission({ role_id: this.activeRole?.key!, page_id: id }).subscribe(\r\n        (res) => {},\r\n        (err) => {\r\n          // 修改出错，重新请求已有权限\r\n          this.getRolePages(this.activeRole?.origin!);\r\n          this.getRolePageActions(this.activeRole?.origin!);\r\n        },\r\n      );\r\n    }\r\n  }\r\n\r\n  // 删除角色\r\n  deleteRole() {\r\n    this.service.deleteRole(this.activeRole?.key!).subscribe((res) => {\r\n      this.getRoles();\r\n    });\r\n  }\r\n}\r\n","<div class=\"layout\">\r\n  <div class=\"container\">\r\n    <div class=\"left\">\r\n      <div class=\"handle padding-x\" nz-row nzAlign=\"middle\">\r\n        <nz-button-group>\r\n          <button nz-button nzType=\"primary\" (click)=\"roleModel.add()\">添加</button>\r\n          <button nz-button [disabled]=\"!activeRole\" (click)=\"roleModel.update()\">修改</button>\r\n          <button\r\n            nz-button\r\n            nzType=\"primary\"\r\n            nzDanger\r\n            [disabled]=\"!activeRole\"\r\n            nz-popconfirm\r\n            nzPopconfirmTitle=\"确认删除该角色?\"\r\n            nzPopconfirmPlacement=\"bottom\"\r\n            (nzOnConfirm)=\"deleteRole()\"\r\n          >\r\n            删除\r\n          </button>\r\n        </nz-button-group>\r\n      </div>\r\n      <div class=\"tree\">\r\n        <div class=\"view_scroll padding\">\r\n          <nz-tree [nzData]=\"roles\" nzShowIcon nzBlockNode (nzClick)=\"roleClick($event)\"></nz-tree>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"right\">\r\n      <div class=\"view_scroll\" style=\"padding: 20px 40px\">\r\n        <nz-table #nzTable [nzData]=\"pages\" nzTableLayout=\"fixed\" nzShowPagination=\"false\">\r\n          <thead>\r\n            <tr>\r\n              <th nzWidth=\"60px\"></th>\r\n              <th>名称</th>\r\n              <th nzWidth=\"60px\">权限</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <ng-container *ngTemplateOutlet=\"pageTpl; context: { $implicit: pages }\"></ng-container>\r\n            <ng-template #pageTpl let-pages>\r\n              <ng-container *ngFor=\"let page of pages\">\r\n                <tr>\r\n                  <td\r\n                    [ngStyle]=\"{ 'padding-left.px': page.level - 1 ? (page.level - 1) * 50 : false }\"\r\n                    [nzExpand]=\"expandSet.has(page.id)\"\r\n                    (nzExpandChange)=\"onExpandChange(page.id, $event, page.isLeaf)\"\r\n                  ></td>\r\n                  <td><i nz-icon nzType=\"snippets\" nzTheme=\"outline\"></i>{{ page.title }}</td>\r\n                  <td>\r\n                    <label\r\n                      nz-checkbox\r\n                      nzDisabled\r\n                      nz-tooltip\r\n                      nzTooltipPlacement=\"left\"\r\n                      nzTooltipTitle=\"请先选择角色！\"\r\n                      *ngIf=\"!activeRole\"\r\n                    ></label>\r\n                    <label\r\n                      nz-checkbox\r\n                      *ngIf=\"activeRole\"\r\n                      [ngModel]=\"activeRole?.origin?.pages.includes(page.key)\"\r\n                      (ngModelChange)=\"modifyPagePermission($event, page.id)\"\r\n                    ></label>\r\n                  </td>\r\n                </tr>\r\n                <tr [nzExpand]=\"expandSet.has(page.id)\">\r\n                  <div>\r\n                    <table>\r\n                      <tbody>\r\n                        <tr *ngFor=\"let item of pageFunctions.get(page.id)\">\r\n                          <td\r\n                            [ngStyle]=\"{ 'padding-left.px': page.level - 1 ? (page.level - 1) * 50 + 60 : 76 }\"\r\n                            style=\"width: auto\"\r\n                          >\r\n                            <i nz-icon nzType=\"bulb\" nzTheme=\"outline\"></i>{{ item.name }}\r\n                          </td>\r\n                          <td style=\"width: 60px\">\r\n                            <label\r\n                              nz-checkbox\r\n                              nzDisabled\r\n                              nz-tooltip\r\n                              nzTooltipPlacement=\"left\"\r\n                              nzTooltipTitle=\"请先选择角色！\"\r\n                              *ngIf=\"!activeRole\"\r\n                            ></label>\r\n                            <label\r\n                              nz-checkbox\r\n                              *ngIf=\"activeRole\"\r\n                              [ngModel]=\"activeRole.origin?.actions.includes(item.code)\"\r\n                              (ngModelChange)=\"modifyFunctionPermission($event, item.id)\"\r\n                            ></label>\r\n                          </td>\r\n                        </tr>\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                  <table>\r\n                    <tbody>\r\n                      <ng-container *ngTemplateOutlet=\"pageTpl; context: { $implicit: page.children }\"></ng-container>\r\n                    </tbody>\r\n                  </table>\r\n                </tr>\r\n              </ng-container>\r\n            </ng-template>\r\n          </tbody>\r\n        </nz-table>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- 角色操作对话框 -->\r\n<nz-modal\r\n  [(nzVisible)]=\"roleModel.visible\"\r\n  [nzTitle]=\"roleModel.mode ? '添加角色' : '修改角色'\"\r\n  (nzOnCancel)=\"roleModel.cancel()\"\r\n  (nzOnOk)=\"roleModel.mode ? roleModel.addRole() : roleModel.modifyRole()\"\r\n  [nzOkLoading]=\"roleModel.loading\"\r\n>\r\n  <input *nzModalContent nz-input placeholder=\"请输入角色名字\" [(ngModel)]=\"roleModel.value\" />\r\n</nz-modal>\r\n","import { SharedModule } from './../../shared/shared.module';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { NgModule } from '@angular/core';\r\nimport { PermissionSetupComponent } from './permission-setup.component';\r\n\r\nconst route: Routes = [{ path: '', component: PermissionSetupComponent }];\r\n\r\n@NgModule({\r\n  imports: [SharedModule, RouterModule.forChild(route)],\r\n  declarations: [PermissionSetupComponent],\r\n})\r\nexport class PermissionSetupModule {}\r\n"],"sourceRoot":"webpack:///"}